# 代码分析工具使用说明

这是一个基于 `CodeFileParser` 的命令行工具，可以分析 Python、Java、JavaScript 代码文件并输出结构化的 JSON 结果。

## 文件说明

- `analyze_code.py` - 主命令行工具
- `parsers/fileParser/code_file_parser.py` - 核心解析器类
- `test_sample.py` - 测试用的 Python 文件
- `analysis_result.json` - 分析结果示例

## 基本使用

### 分析单个文件
```bash
python analyze_code.py test_sample.py
```

### 分析单个文件并美化输出
```bash
python analyze_code.py test_sample.py --pretty
```

### 分析文件夹
```bash
python analyze_code.py ./parsers
```

### 保存结果到文件
```bash
python analyze_code.py test_sample.py --output result.json --pretty
```

### 限制分析文件数量
```bash
python analyze_code.py ./src --max-files 5
```

### 自定义上下文窗口大小
```bash
python analyze_code.py test_sample.py --window-size 3 --pretty
```

## 命令行参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `target` | 要分析的文件或文件夹路径 | 必需 |
| `-o, --output` | 输出文件路径 | 控制台输出 |
| `--pretty` | 美化JSON输出 | 关闭 |
| `--window-size` | 上下文窗口大小 | 2 |
| `--max-files` | 最大分析文件数量 | 无限制 |

## 输出格式

### 单个文件分析
```json
{
  "type": "single_file",
  "result": {
    "language": "Python",
    "file_context": {
      "file_name": "test.py",
      "imports": ["math", "os"],
      "class_name": "Calculator",
      "function_name": "add"
    },
    "lines": [
      {
        "line_number": 1,
        "content": "import math",
        "ast_features": {
          "node_type": "Import",
          "depth": 2,
          "children_types": ["alias"]
        },
        "context_window": [
          {"line": 1, "content": "import math"},
          {"line": 2, "content": ""}
        ]
      }
    ],
    "meta": {
      "file_size": 1234,
      "absolute_path": "/path/to/file.py"
    }
  }
}
```

### 文件夹分析
```json
{
  "type": "folder",
  "result": {
    "summary": {
      "total_files": 5,
      "analyzed_files": 4,
      "failed_files": 1,
      "folder_path": "/path/to/folder",
      "languages_found": ["Python", "JavaScript"]
    },
    "files": [
      {
        "language": "Python",
        "file_context": {...},
        "lines": [...],
        "meta": {...}
      }
    ]
  }
}
```

## 支持的文件类型

- Python: `.py`
- Java: `.java` 
- JavaScript: `.js`, `.jsx`, `.ts`, `.tsx`

## 功能特点

### 语言检测
- 优先使用文件扩展名
- 无扩展名时使用内容启发式规则

### AST 特征提取
- **Python**: 使用标准库 `ast` 模块，提供准确的语法分析
- **Java**: 使用正则表达式模式匹配，识别类、方法、变量声明
- **JavaScript**: 使用正则表达式模式匹配，支持 ES6+ 语法

### 上下文窗口
- 为每行代码提供前后 N 行的上下文信息
- 可通过 `--window-size` 参数调整

### 错误处理
- 单行解析错误不影响整个文件处理
- 提供降级解析策略
- 详细的错误日志

## 使用示例

### 分析 Python 项目
```bash
# 分析整个项目，限制最多10个文件，保存结果
python analyze_code.py ./my_project --max-files 10 --output project_analysis.json --pretty

# 只分析特定文件
python analyze_code.py main.py models.py --pretty
```

### 快速查看文件结构
```bash
# 查看文件的基本信息（语言、导入、类/函数）
python analyze_code.py app.py | jq '.result.file_context'
```

### 检查代码复杂度
```bash
# 查看 AST 深度分布，了解代码复杂度
python analyze_code.py complex_file.py | jq '.result.lines[].ast_features.depth'
```

## 注意事项

1. **性能**: 大文件或大量文件可能需要较长时间处理
2. **编码**: 工具会自动尝试 UTF-8 和 GBK 编码
3. **内存**: 整个文件内容会加载到内存中
4. **精度**: Java 和 JavaScript 的 AST 分析相对简化

## 故障排除

### 文件读取失败
- 检查文件路径是否正确
- 确认文件编码格式
- 检查文件权限

### 解析结果为空
- 确认文件类型是否支持
- 检查文件内容是否为有效代码
- 查看错误日志

### 输出过大
- 使用 `--max-files` 限制文件数量
- 考虑分批处理大型项目
- 不使用 `--pretty` 减少输出大小 